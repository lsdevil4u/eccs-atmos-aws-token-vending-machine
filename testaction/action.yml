name: 'Token Vending Machine'
description: 'Call the Sanofi AWS Token Vending Machine'
inputs:
  targetRoleArn:
    description: 'IAM Role ARN to assume'
    required: true
  targetRoleExternalId:
    description: 'External ID of the IAM Role'
    required: true
  tvmToken:
    description: 'Token generated by the TVM'
    required: true
runs:
  using: "composite"
  steps:
    - run: |
        echo "::add-mask::${{ inputs.tvmToken }}"
        echo "::add-mask::${{ inputs.targetRoleExternalId }}"
        echo "::add-mask::$AWS_SECRET_ACCESS_KEY"
        echo "::add-mask::$AWS_SESSION_TOKEN"
      shell: bash
    - run: $GITHUB_ACTION_PATH/tvm.sh ${{ inputs.tvmToken }} ${{ inputs.targetRoleArn }} ${{ inputs.targetRoleExternalId }}
      shell: bash
